(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{240:function(e,t,a){"use strict";var i=a(95);var n=a.n(i);var l=n.a},245:function(e,t,a){"use strict";var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"body"},[a("div",{staticClass:"container"},[!e.yesterdayDaliy?a("div",[a("bk-alert",{attrs:{type:"warning",title:"昨天的日报还没写！记得补上哦！",closable:""}})],1):e._e(),e._v(" "),a("div",{staticClass:"top_container"},[a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:"primary"},on:{click:e.clickLeaveManage}},[e._v("\n                请假管理\n            ")]),e._v(" "),a("div",[a("span",{staticClass:"f16",staticStyle:{display:"inline-block"}},[e._v("选择日期：")]),e._v(" "),a("bk-date-picker",{attrs:{clearable:false,placeholder:"选择日期",options:e.customOption},on:{change:function(t){e.changeDate(e.reportDate)}},model:{value:e.reportDate,callback:function(t){e.reportDate=t},expression:"reportDate"}})],1),e._v(" "),a("div",{staticStyle:{padding:"5px 0"}},[a("p",{staticStyle:{margin:"0"}},[a("span",[e._v("日报状态：")]),e._v(" "),e.hasWrittenToday?a("span",{staticStyle:{color:"#3A84FF"}},[e._v("已写日报")]):a("span",{staticStyle:{color:"#63656E"}},[e._v("未写日报")])])]),e._v(" "),a("div",{staticStyle:{padding:"4px 0 6px"}},[a("span",{staticClass:"mr10"},[e._v("隐私模式")]),e._v(" "),a("bk-switcher",{on:{change:e.setAllPrivate},model:{value:e.allPrivate,callback:function(t){e.allPrivate=t},expression:"allPrivate"}})],1),e._v(" "),a("bk-sideslider",{attrs:{width:"600","is-show":e.leaveSetting.visible,"quick-close":true,direction:"right","ext-cls":"leave-slide"},on:{"update:isShow":function(t){e.$set(e.leaveSetting,"visible",t)},hidden:e.hiddenSlider}},[a("div",{staticClass:"slide-header",attrs:{slot:"header"},slot:"header"},e._l(e.slideTitleList,function(t,i){return a("div",{key:i,class:{"header-tabs":true,"tabs-active":t===e.activeTabTitle},on:{click:function(a){e.changeTab(t)}}},[e._v("\n                        "+e._s(t)+"\n                    ")])}),0),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.activeTabTitle===e.slideTitleList[0],expression:"activeTabTitle === slideTitleList[0]"}],staticClass:"leave-body",staticStyle:{height:"530px",padding:"30px 0 0 10px"}},[a("div",{staticClass:"leave-apply"},[a("bk-form",{attrs:{"label-width":80,"form-type":"horizontal"}},[a("bk-form-item",{attrs:{label:"请假日期",required:true}},[a("bk-date-picker",{staticClass:"mr15",attrs:{clearable:false,placeholder:"选择日期范围",type:"daterange",options:e.customLeaveOption},on:{clear:e.clearDate},model:{value:e.leaveFormData.dateTimeRange,callback:function(t){e.$set(e.leaveFormData,"dateTimeRange",t)},expression:"leaveFormData.dateTimeRange"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"请假原因"}},[a("bk-input",{attrs:{placeholder:"",type:"textarea",rows:3,maxlength:255},model:{value:e.leaveFormData.reason,callback:function(t){e.$set(e.leaveFormData,"reason",t)},expression:"leaveFormData.reason"}})],1),e._v(" "),a("bk-form-item",{staticClass:"mt20"},[a("bk-button",{staticStyle:{"margin-right":"3px"},attrs:{theme:"primary",title:"提交"},on:{click:function(t){t.stopPropagation();t.preventDefault();return e.submitLeave(t)}}},[e._v("提交")])],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.activeTabTitle===e.slideTitleList[1],expression:"activeTabTitle === slideTitleList[1]"}],staticClass:"leave-body",staticStyle:{padding:"30px 10px 0"}},[a("div",{staticClass:"leave-manage"},[a("div",{staticClass:"select-bar"},[a("div",{staticClass:"ptitle"},[e._v("选择组")]),e._v(" "),a("bk-select",{staticStyle:{width:"200px"},attrs:{disabled:false,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:""},on:{selected:e.handleSelectGroup},model:{value:e.selectedGroup,callback:function(t){e.selectedGroup=t},expression:"selectedGroup"}},e._l(e.groupList,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})}),1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isleaveTableLoad,expression:"isleaveTableLoad"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isleaveTableLoad,theme:"primary",zIndex:10},expression:"{ isLoading: isleaveTableLoad, theme: 'primary', zIndex: 10 }"}],staticClass:"leave-load"}),e._v(" "),a("bk-table",{directives:[{name:"show",rawName:"v-show",value:!e.isleaveTableLoad,expression:"!isleaveTableLoad"}],attrs:{"virtual-render":false,data:e.leaveTableData.data,size:e.leaveTableData.size,"outer-border":false,"header-border":false,"header-cell-style":{background:"#fff"}},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[a("div",{attrs:{slot:"empty-text"},slot:"empty-text"},[e._v("\n                                    空数据\n                                ")]),e._v(" "),a("bk-table-column",{attrs:{label:"人员信息",prop:"info","min-width":"150","show-overflow-tooltip":"true"}}),e._v(" "),a("bk-table-column",{attrs:{label:"请假时间",prop:"leaveDate","min-width":"180","show-overflow-tooltip":"true"}}),e._v(" "),a("bk-table-column",{attrs:{label:"请假理由",prop:"reason","show-overflow-tooltip":"true"}})],1)],1)])])]),e._v(" "),a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:"primary"},on:{click:function(t){e.moreTemplateDialog.visible=true}}},[e._v("\n                添加模板\n            ")])],1),e._v(" "),a("div",{staticClass:"bottom_container"},[e._l(e.dailyDataContent,function(t,i){return[a("div",{key:i},[a("div",{staticStyle:{display:"flex","justify-content":"space-between",margin:"10px 0"}},[a("h2",{ref:"title"+i,refInFor:true,staticStyle:{display:"inline-block",margin:"0"},attrs:{contenteditable:"true"},on:{input:function(t){e.changeTitleText(i)}}},[e._v(e._s(t.title))])]),e._v(" "),a("div",[a("bk-table",{staticStyle:{"margin-top":"15px"},attrs:{data:t.content,"virtual-render":true}},[a("div",{staticStyle:{"text-align":"left",padding:"10px 15px"},attrs:{slot:"append"},slot:"append"},[a("bk-button",{staticStyle:{display:"inline-block"},attrs:{text:""},on:{click:function(t){e.dealAdd(i)}}},[e._v("\n                                    新增一条内容\n                                ")])],1),e._v(" "),a("bk-table-column",{attrs:{label:"内容"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("bk-input",{attrs:{placeholder:"新内容",type:"textarea",rows:3},model:{value:t.content[i.row.$index].text,callback:function(a){e.$set(t.content[i.row.$index],"text",a)},expression:"singleContent.content[props.row.$index].text"}})]}}])}),e._v(" "),a("bk-table-column",{attrs:{width:"250",label:"所花时间"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("bk-input",{attrs:{placeholder:"所花时间",type:"number",precision:1,min:0,max:24},model:{value:t.content[i.row.$index].cost,callback:function(a){e.$set(t.content[i.row.$index],"cost",a)},expression:"singleContent.content[props.row.$index].cost"}},[a("template",{slot:"append"},[a("div",{staticClass:"group-text"},[e._v("小时")])])],2)]}}])}),e._v(" "),a("bk-table-column",{attrs:{width:"100",label:"隐私模式"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("bk-switcher",{model:{value:t.content[i.row.$index].isPrivate,callback:function(a){e.$set(t.content[i.row.$index],"isPrivate",a)},expression:"singleContent.content[props.row.$index].isPrivate"}})]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("bk-button",{attrs:{theme:"danger",text:""},on:{click:function(a){e.deleteContent(t.row,i)}}},[e._v("\n                                        删除\n                                    ")])]}}])})],1)],1)])]}),e._v(" "),a("bk-dialog",{attrs:{"header-position":e.moreTemplateDialog.headerPosition,width:e.moreTemplateDialog.width},on:{"value-change":e.moreTemplateDialogChange},model:{value:e.moreTemplateDialog.visible,callback:function(t){e.$set(e.moreTemplateDialog,"visible",t)},expression:"moreTemplateDialog.visible"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"mr30"},[e._v("新增模板标题")])]),e._v(" "),a("div",[a("bk-input",{attrs:{placeholder:"新增模板标题",type:"text"},model:{value:e.newTitle,callback:function(t){e.newTitle=t},expression:"newTitle"}})],1),e._v(" "),a("div",{staticClass:"dialog-foot",attrs:{slot:"footer"},slot:"footer"},[a("div",[a("bk-button",{attrs:{theme:"primary",title:"添加"},on:{click:e.addTemplate}},[e._v("\n                            添加\n                        ")])],1)])])],2),e._v(" "),e._l(e.newTemplateContent,function(t,i){return[a("div",{key:i},[a("div",{staticStyle:{display:"flex","justify-content":"space-between",margin:"10px 0"}},[a("h2",{staticStyle:{display:"inline-block",margin:"0"}},[e._v(e._s(t.title))]),e._v(" "),i>0?a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:"primary"},on:{click:function(t){e.deleteTemplate(i)}}},[e._v("\n                        删除该模板\n                    ")]):e._e()],1),e._v(" "),a("bk-input",{attrs:{placeholder:"请输入",type:"textarea",rows:3},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"tem.text"}})],1)]}),e._v(" "),a("div",{staticClass:"saveBtn"},[a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:e.hasWrittenToday?"warning":"primary"},on:{click:e.saveDaily}},[e._v("\n                "+e._s(e.hasWrittenToday?"修改":"保存")+"\n            ")])],1)],2)])};var n=[];a.d(t,"a",function(){return i});a.d(t,"b",function(){return n})},74:function(e,t,a){"use strict";a.r(t);var i=a(245);var n=a(93);for(var l in n)if(l!=="default")(function(e){a.d(t,e,function(){return n[e]})})(l);var s=a(240);var r=a(3);var o=Object(r["a"])(n["default"],i["a"],i["b"],false,null,"400c25d2",null);t["default"]=o.exports},93:function(e,t,a){"use strict";a.r(t);var i=a(94);var n=a.n(i);for(var l in i)if(l!=="default")(function(e){a.d(t,e,function(){return i[e]})})(l);t["default"]=n.a},94:function(e,t,a){"use strict";var i=a(0);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;a(29);a(75);var n=i(a(30));var l=i(a(76));var s=i(a(77));var r=i(a(78));var o=i(a(79));var c=i(a(80));var d=i(a(81));var u=i(a(82));var f=i(a(108));var v=i(a(83));var p=i(a(92));function h(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=m(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var i=0;var n=function e(){};return{s:n,n:function t(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=true,s=false,r;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();l=t.done;return t},e:function e(t){s=true;r=t},f:function e(){try{if(!l&&a.return!=null)a.return()}finally{if(s)throw r}}}}function m(e,t){if(!e)return;if(typeof e==="string")return b(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return b(e,t)}function b(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,i=new Array(t);a<t;a++){i[a]=e[a]}return i}var y={name:"",components:{bkInput:v.default,bkDatePicker:f.default,bkTable:u.default,bkTableColumn:d.default,bkButton:c.default,bkSideslider:o.default,bkForm:r.default,bkFormItem:s.default,bkAlert:l.default},data:function e(){return{yesterdayDaliy:true,curDate:new Date,reportDate:new Date,formatDate:"",moreTemplateDialog:{visible:false,width:600,headerPosition:"left"},targetRow:0,dailyDataTitle:["今日任务","明日计划"],dailyDataContent:[{title:"今日任务",type:"table",content:[]},{title:"明日计划",type:"table",content:[]}],allPrivate:true,dailyDates:[],newTemplateContent:[{title:"感想",type:"text",text:""}],newTitle:"",currentIndex:0,newPostDaily:{date:null,content:[],template_id:0,send_email:false},hasWrittenToday:false,customOption:{disabledDate:function e(t){if(t>new Date){return true}}},leaveSetting:{visible:false},isleaveTableLoad:true,leaveTableData:{size:"small",data:[],isAdmin:false},leaveFormData:{reason:"",dateTimeRange:[new Date,new Date]},slideTitleList:["请假申请","请假信息"],activeTabTitle:"请假申请",groupList:[],selectedGroup:-1,customLeaveOption:{disabledDate:function e(t){var a=new Date;if(t<a.setHours(a.getHours()-24)){return true}}},curUserLeaveList:[],virtualRenderConfig:{height:226}}},created:function e(){this.formatDate=(0,p.default)(new Date).format(p.default.HTML5_FMT.DATE);var t=this.$route.query.date;if(t!==undefined){this.reportDate=new Date(t);this.formatDate=t}else{this.reportDate=new Date}this.init()},activated:function e(){var t=this;this.$http.get("/get_user_groups/").then(function(e){if(e.result){if(e.data.length===0){t.$router.push({name:"MyGroup"})}}else{t.$bkMessage({theme:"error",message:e.message})}t.getDailyReport()})},methods:{changeDate:function e(t){this.formatDate=(0,p.default)(t).format(p.default.HTML5_FMT.DATE);this.getDailyReport()},cheakDailyDates:function e(){var t=this;this.$http.get("/get_reports_dates/").then(function(e){if(e.result){t.dailyDates=e.data;t.customOption={disabledDate:function e(a){if((0,p.default)(a).format("YYYY-MM-DD")!==(0,p.default)(new Date).format("YYYY-MM-DD")&&(t.dailyDates.includes((0,p.default)(a).format("YYYY-MM-DD"))||a>new Date)){return true}}}}else{t.$bkMessage({offsetY:80,message:e.message,theme:"error"})}})},changeTemplate:function e(){if(this.curTemplateId===null||this.curTemplateId===""){this.curTemplate=[];this.dailyData=[]}},checkYesterdayDaliy:function e(){var t=this;this.$http.get("/check_yesterday_daliy/").then(function(e){t.yesterdayDaliy=!!e.data})},init:function e(){var t=this;this.cheakDailyDates();this.getDailyReport();this.$http.get("/get_user_groups/").then(function(e){if(e.result){if(e.data.length!==0&&e.data.length!==null){t.groupList=e.data;if(t.groupList.length!==0&&t.groupList.length!==undefined){t.selectedGroup=t.groupList[0].id}}else{t.groupList=[]}}else{t.$bkMessage({theme:"error",message:e.message})}});this.checkYesterdayDaliy()},setAllPrivate:function e(t){var a=h(this.dailyDataContent),i;try{for(a.s();!(i=a.n()).done;){var n=i.value;var l=h(n.content),s;try{for(l.s();!(s=l.n()).done;){var r=s.value;r.isPrivate=t}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}},getDailyReport:function e(){var t=this;this.$http.get("/daily_report/?date="+this.formatDate).then(function(e){if(Object.keys(e.data).length){t.hasWrittenToday=true;t.dailyDataTitle=[];t.dailyDataContent=[];t.newTemplateContent=[];var a=h(e.data.content),i;try{for(a.s();!(i=a.n()).done;){var n=i.value;if(n.type==="table"){t.dailyDataTitle.push(n.title);t.dailyDataContent.push(n)}else{t.newTemplateContent.push(n)}}}catch(e){a.e(e)}finally{a.f()}}else{t.hasWrittenToday=false;t.dailyDataTitle=["今日任务","明日计划"];t.dailyDataContent=[{title:"今日任务",type:"table",content:[]},{title:"明日计划",type:"table",content:[]}];t.newTemplateContent=[{title:"感想",type:"text",text:""}]}})},changeTitleText:function e(t){var a="title"+t;this.dailyDataTitle[t]=this.$refs[a][0].innerText},dealAdd:function e(t){var a=this.dailyDataContent[t].content.length;if(a&&!this.dailyDataContent[t].content[a-1].text){this.$bkMessage({theme:"warning",message:"前一条内容为空"})}else{var i={text:"",cost:0,isPrivate:this.allPrivate};this.dailyDataContent[t].content.push(i)}},deleteContent:function e(t,a){this.dailyDataContent[a]["content"].splice(t.$index,1);this.$bkMessage({theme:"success",message:"移除成功"})},saveDaily:function e(){var t=this;var a=false;var i=[];this.newPostDaily.date=this.formatDate;for(var l in this.dailyDataContent){this.dailyDataContent[l].title=this.dailyDataTitle[l]}var s=h(this.dailyDataContent),r;try{for(s.s();!(r=s.n()).done;){var o=r.value;var c=o.content.length;if(c){if(!o.content[c-1].text){a=true;i.push(o.title+"最后一条")}else{var d=h(o.content),u;try{for(d.s();!(u=d.n()).done;){var f=u.value;f.cost=parseFloat(f.cost);console.log((0,n.default)(f.cost))}}catch(e){d.e(e)}finally{d.f()}this.newPostDaily.content.push(o)}}else{a=true;i.push(o.title)}}}catch(e){s.e(e)}finally{s.f()}var v=h(this.newTemplateContent),p;try{for(v.s();!(p=v.n()).done;){var m=p.value;if(!m.text.length){a=true;i.push(m.title)}this.newPostDaily.content.push(m)}}catch(e){v.e(e)}finally{v.f()}if(!a){this.$http.post("/daily_report/",this.newPostDaily).then(function(e){t.hasWrittenToday=true;console.log(t.newPostDaily);t.newPostDaily={date:null,content:[],template_id:0,send_email:false};t.$bkMessage({theme:"success",message:e.message})})}else{this.$bkMessage({theme:"warning",message:i.join(",")+" 内容为空！"});this.newPostDaily.content=[]}},addTemplate:function e(){this.newTemplateContent.push({title:this.newTitle,type:"text",text:""});this.moreTemplateDialog.visible=false},deleteTemplate:function e(t){this.newTemplateContent.splice(t,1)},moreTemplateDialogChange:function e(t){if(t===false){this.newTitle=""}},getLeaveList:function e(t){var a=this;var i=this.selectedGroup;if(t===null||t===undefined){t=0}if(i===-1){this.$bkMessage({offsetY:80,delay:2e3,theme:"warning",message:"用户当前未加入任何组，无请假信息。"})}else{var n=this;this.isleaveTableLoad=true;this.leaveTableData.data=[];var l=(0,p.default)(new Date).format(p.default.HTML5_FMT.DATE);this.$http.get("/display_personnel_information/"+i+"/?date="+l+"&sign="+t).then(function(e){if(e.result){if(e.data.length!==null&&e.data.length!==0){if(t===2){a.curUserLeaveList=e.data;a.customLeaveOption={disabledDate:function e(t){var a=new Date;if(t<a.setHours(a.getHours()-24)){return true}else{var i=true;n.curUserLeaveList.map(function(e,a){var n=(0,p.default)(e[0]).format("YYYY-MM-DD");var l=(0,p.default)(t).format("YYYY-MM-DD");var s=(0,p.default)(e[1]).format("YYYY-MM-DD");if((0,p.default)(n).isSameOrBefore(l,"day")&&(0,p.default)(l).isSameOrBefore(s,"day")){i=false}});return!i}}}}else if(t===0){e.data.map(function(e,t){a.leaveTableData.data.push({offdayId:e.off_info.id,leaveDate:e.off_info.start_date+"  ~  "+e.off_info.end_date,reason:e.off_info.reason,info:e.username+"("+e.name+")",username:e.username})})}}}else{a.$bkMessage({offsetY:80,delay:2e3,theme:"warning",message:e.message})}}).finally(function(){a.isleaveTableLoad=false})}},hiddenSlider:function e(){this.leaveFormData.reason="";this.leaveFormData.dateTimeRange=[new Date,new Date];this.activeTabTitle="请假申请"},changeTab:function e(t){this.activeTabTitle=t;if(this.activeTabTitle==="请假信息"){this.getLeaveList();this.getLeaveList(2)}},handleSelectGroup:function e(t,a){this.getLeaveList();this.getLeaveList(2)},clearDate:function e(){this.leaveFormData.dateTimeRange=-1},submitLeave:function e(){var t=this;var a={};a.start_date=(0,p.default)(this.leaveFormData.dateTimeRange[0]).format(p.default.HTML5_FMT.DATE);a.end_date=(0,p.default)(this.leaveFormData.dateTimeRange[1]).format(p.default.HTML5_FMT.DATE);a.reason=this.leaveFormData.reason;this.$http.post("/add_off_info/",a).then(function(e){if(e.result){t.$bkMessage({offsetY:80,delay:2e3,theme:"success",message:e.message});t.getLeaveList(2)}else{t.$bkMessage({offsetY:80,delay:2e3,theme:"warning",message:e.message})}})},clickLeaveManage:function e(){this.leaveSetting.visible=true;this.getLeaveList(2)}}};t.default=y},95:function(e,t,a){}}]);