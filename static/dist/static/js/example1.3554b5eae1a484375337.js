(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{100:function(e,t,a){"use strict";var n=a(0);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;a(30);a(260);var i=n(a(92));var s={components:{bkButton:i.default},props:{state:{type:Boolean,default:true},scope:{type:Boolean,default:false}},methods:{changeState:function e(){this.state=!this.state;this.$emit("changeState",this.state)}}};t.default=s},101:function(e,t,a){},102:function(e,t,a){},264:function(e,t,a){"use strict";a.r(t);var n=a(284);var i=a(99);for(var s in i)if(s!=="default")(function(e){a.d(t,e,function(){return i[e]})})(s);var r=a(265);var o=a(3);var l=Object(o["a"])(i["default"],n["a"],n["b"],false,null,"44be8210",null);t["default"]=l.exports},265:function(e,t,a){"use strict";var n=a(101);var i=a.n(n);var s=i.a},266:function(e,t,a){"use strict";var n=a(102);var i=a.n(n);var s=i.a},279:function(e,t,a){"use strict";var n=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{staticClass:"body"},[a("div",{staticClass:"container"},[a("div",{staticClass:"top-container"},[a("div",{staticClass:"top-container-left"},[a("div",{staticClass:"top-container-left-picker"},[a("bk-date-picker",{attrs:{clearable:false,placeholder:"选择日期",options:e.customOption,"shortcut-close":true},on:{change:e.changeDate},model:{value:e.formatDate,callback:function(t){e.formatDate=t},expression:"formatDate"}})],1),e._v(" "),a("div",[a("bk-button",{staticClass:"top-container-right-btn",attrs:{"hover-theme":"primary"},on:{click:e.clickLeaveManage}},[e._v("\n                        请假管理\n                    ")])],1)]),e._v(" "),a("div",{staticClass:"top-container-right"},[a("div",[a("Onoff",{staticClass:"allOnoff",attrs:{scope:true},on:{changeState:e.setAllPrivate}})],1),e._v(" "),a("bk-button",{staticClass:"top-container-right-btn savedaily",staticStyle:{display:"inline-block"},attrs:{"hover-theme":"primary"},on:{click:e.saveDaily}},[e._v("\n                    "+e._s(e.hasWrittenToday?"修改":"保存")+"\n                ")])],1)]),e._v(" "),a("div",{staticClass:"bottom_container"},[e._l(e.renderList.dailyDataContent,function(t,n){return[a("div",{key:t,staticStyle:{"margin-bottom":"20px"}},[a("h3",{ref:"title"+n,refInFor:true,staticClass:"top-h3"},[e._v(e._s(t.title))]),e._v(" "),e._l(t.content,function(t,i){return a("div",{key:t.$index,staticClass:"single-card-box"},[a("div",{staticClass:"single-card-header"},[a("bk-input",{ref:"numberDom"+n+i,refInFor:true,staticStyle:{"margin-top":"10px",width:"50px"},attrs:{type:"number",placeholder:"时间","show-controls":false},on:{blur:function(a){e.changeNumber(t,n,i,a)}},model:{value:t.cost,callback:function(a){e.$set(t,"cost",a)},expression:"item.cost"}}),e._v(" "),a("div",{staticClass:"input-append"},[e._v("h")]),e._v(" "),a("Onoff",{staticClass:"Onoff",attrs:{state:t.isPrivate},on:{changeState:function(e){t.isPrivate=e}}}),e._v(" "),a("bk-icon",{staticStyle:{position:"absolute",top:"-8px",right:"-8px",cursor:"pointer",fontSize:"25px"},attrs:{type:"close"},on:{click:function(a){e.textChange(t,n)}}})],1),e._v(" "),a("bk-input",{staticClass:"content-textarea",attrs:{placeholder:"请填写内容",type:"textarea",rows:3,maxlength:255},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}})],1)}),e._v(" "),a("div",{staticClass:"renderli"},[a("div",{staticClass:"renderli-add-btn",on:{click:function(t){e.dealAdd(n)}}},[e._v("\n                            + 添加一条\n                        ")])])],2)]}),e._v(" "),e._l(e.renderList.newTemplateContent,function(t,n){return[a("div",{key:n,staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"temp-top"},[a("h3",{staticClass:"top-h3"},[e._v("\n                            "+e._s(t.title)+"\n                        ")])]),e._v(" "),a("div",{staticClass:"single-card-box temtextarea"},[a("bk-input",{staticClass:"content-textarea",attrs:{placeholder:"请填写内容",type:"textarea",rows:3,maxlength:255},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"tem.text"}})],1)])]})],2),e._v(" "),a("bk-sideslider",{attrs:{width:"600","is-show":e.leaveSetting.visible,"quick-close":true,direction:"right","ext-cls":"leave-slide"},on:{"update:isShow":function(t){e.$set(e.leaveSetting,"visible",t)},hidden:e.hiddenSlider}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("bk-date-picker",{directives:[{name:"show",rawName:"v-show",value:e.activeTabTitle==="请假申请",expression:"activeTabTitle === '请假申请'"}],staticClass:"slide-header-picker",attrs:{clearable:false,placeholder:"选择日期范围",type:"daterange",options:e.customLeaveOption},on:{clear:e.clearDate},model:{value:e.leaveFormData.dateTimeRange,callback:function(t){e.$set(e.leaveFormData,"dateTimeRange",t)},expression:"leaveFormData.dateTimeRange"}}),e._v(" "),a("bk-select",{directives:[{name:"show",rawName:"v-show",value:e.activeTabTitle==="请假信息",expression:"activeTabTitle === '请假信息'"}],staticClass:"slide-header-select",staticStyle:{width:"200px"},attrs:{disabled:false,"ext-popover-cls":"select-popover-custom",searchable:""},on:{selected:e.handleSelectGroup},model:{value:e.selectedGroup,callback:function(t){e.selectedGroup=t},expression:"selectedGroup"}},e._l(e.groupList,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})}),1),e._v(" "),a("div",{staticClass:"bk-button-group"},[a("bk-button",{class:e.activeTabTitle==="请假申请"?"is-selected":"",on:{click:function(t){e.changeTab("请假申请")}}},[e._v("请假申请")]),e._v(" "),a("bk-button",{class:e.activeTabTitle==="请假信息"?"is-selected":"",on:{click:function(t){e.changeTab("请假信息")}}},[e._v("请假信息")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.activeTabTitle===e.slideTitleList[0],expression:"activeTabTitle === slideTitleList[0]"}],staticClass:"leave-body"},[a("div",{staticClass:"temp-top"},[a("h3",{staticClass:"top-h3"},[e._v("\n                            请假原因\n                        ")])]),e._v(" "),a("div",{staticClass:"single-card-box temtextarea leave-body-textarea"},[a("bk-input",{attrs:{placeholder:"请填写内容",type:"textarea",rows:3,maxlength:50},model:{value:e.leaveFormData.reason,callback:function(t){e.$set(e.leaveFormData,"reason",t)},expression:"leaveFormData.reason"}})],1),e._v(" "),a("bk-button",{staticClass:"leave-body-submit",attrs:{"hover-theme":"primary"},on:{click:e.submitLeave}},[e._v("\n                        提交\n                    ")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.activeTabTitle===e.slideTitleList[1],expression:"activeTabTitle === slideTitleList[1]"}],staticClass:"leave-body",staticStyle:{padding:"30px 10px 0"}},[a("div",{staticClass:"leave-manage"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isleaveTableLoad,expression:"isleaveTableLoad"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isleaveTableLoad,theme:"primary",zIndex:10},expression:"{ isLoading: isleaveTableLoad, theme: 'primary', zIndex: 10 }"}],staticClass:"leave-load"}),e._v(" "),a("bk-table",{directives:[{name:"show",rawName:"v-show",value:!e.isleaveTableLoad,expression:"!isleaveTableLoad"}],attrs:{"virtual-render":false,data:e.leaveTableData.data,size:e.leaveTableData.size,"outer-border":false,"header-border":false,"header-cell-style":{background:"#fff"}},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[a("div",{attrs:{slot:"empty-text"},slot:"empty-text"},[e._v("\n                                空数据\n                            ")]),e._v(" "),a("bk-table-column",{attrs:{label:"人员信息","min-width":"30"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.username))]),e._v(" "),a("div",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"请假时间","min-width":"10"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.start_date))]),e._v(" "),a("div",[e._v(e._s(t.row.end_date))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"请假理由",prop:"reason","min-width":"200","show-overflow-tooltip":"true"}}),e._v(" "),a("bk-table-column",{attrs:{label:"操作",width:"66"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("bk-button",{staticClass:"mr10",attrs:{disabled:t.row.username!==e.myMsg.username&&!e.isAdmin,theme:"primary",text:""},on:{click:function(a){e.removeLeave(t.row)}}},[e._v("删除")])]}}])})],1)],1)])],1)])],1)])};var i=[];a.d(t,"a",function(){return n});a.d(t,"b",function(){return i})},284:function(e,t,a){"use strict";var n=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("bk-button",{attrs:{"hover-theme":e.scope?"primary":""},on:{click:e.changeState}},[a("bk-icon",{staticStyle:{marginRight:"3px"},attrs:{type:e.state===true?"eye-slash":"eye"}}),e._v("\n    "+e._s(e.scope===true?"全部":"")+e._s(e.state===true?"私密":"公开")+"\n")],1)};var i=[];a.d(t,"a",function(){return n});a.d(t,"b",function(){return i})},79:function(e,t,a){"use strict";a.r(t);var n=a(279);var i=a(96);for(var s in i)if(s!=="default")(function(e){a.d(t,e,function(){return i[e]})})(s);var r=a(266);var o=a(3);var l=Object(o["a"])(i["default"],n["a"],n["b"],false,null,"4f789a78",null);t["default"]=l.exports},96:function(e,t,a){"use strict";a.r(t);var n=a(97);var i=a.n(n);for(var s in n)if(s!=="default")(function(e){a.d(t,e,function(){return n[e]})})(s);t["default"]=i.a},97:function(e,t,a){"use strict";var n=a(0);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;a(30);a(80);var i=n(a(81));var s=n(a(92));var r=n(a(131));var o=n(a(132));var l=n(a(98));var c=n(a(82));var u=n(a(90));var d=n(a(264));var f=n(a(31));var v=a(91);var h=a(91);function m(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=p(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var n=0;var i=function e(){};return{s:i,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,r=false,o;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();s=t.done;return t},e:function e(t){r=true;o=t},f:function e(){try{if(!s&&a.return!=null)a.return()}finally{if(r)throw o}}}}function p(e,t){if(!e)return;if(typeof e==="string")return b(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return b(e,t)}function b(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,n=new Array(t);a<t;a++){n[a]=e[a]}return n}var g=f.default.getallGroups,y=f.default.getReportsDates,D=f.default.getYesterday,T=f.default.getAppointDaily,w=f.default.selectPerMsg,_=f.default.applyRest,k=f.default.removeOff,L=f.default.setUpdateDaily;var x={components:{bkInput:c.default,bkDatePicker:l.default,bkTable:o.default,bkTableColumn:r.default,bkButton:s.default,bkSideslider:i.default,Onoff:d.default},data:function e(){return{myMsg:JSON.parse(window.localStorage.getItem("userMsg")),isAdmin:null,formatDate:(0,u.default)(new Date).format(u.default.HTML5_FMT.DATE),moreTemplateDialog:{visible:false,width:600,headerPosition:"left"},renderList:{dailyDataTitle:["今日任务","明日计划"],dailyDataContent:[{title:"今日任务",type:"table",content:[]},{title:"明日计划",type:"table",content:[]}],newTemplateContent:[{title:"感想",type:"text",text:""}]},allPrivate:true,dailyDates:[],newTitle:"",currentIndex:0,newPostDaily:{date:null,content:[],template_id:0,send_email:false},hasWrittenToday:false,customOption:{disabledDate:function e(t){if(t>new Date){return true}}},leaveSetting:{visible:false},isleaveTableLoad:true,leaveTableData:{size:"medium",data:[],isAdmin:false},leaveFormData:{reason:"",dateTimeRange:[new Date,new Date]},slideTitleList:["请假申请","请假信息"],activeTabTitle:"请假申请",groupList:[],selectedGroup:-1,customLeaveOption:{disabledDate:function e(t){var a=new Date;if(t<a.setHours(a.getHours()-24)){return true}}},curUserLeaveList:[]}},watch:{selectedGroup:function e(t){this.isAdmin=(0,v.isAdmin)(this.myMsg.username,this.groupList.filter(function(e){return e.id===t})[0].admin)}},created:function e(){if(this.$route.query.date!==undefined){this.formatDate=this.$route.query.date}this.init()},activated:function e(){var t=this;g().then(function(e){if(e.result){if(e.data.length===0){t.$router.push({name:"MyGroup"})}else{(0,h.setCurGroup)(e.data[0].id)}}else{t.showBkMessage(e.message)}})},methods:{changeDate:function e(t){this.formatDate=(0,u.default)(t).format(u.default.HTML5_FMT.DATE);this.getDailyReport()},cheakDailyDates:function e(){var t=this;y().then(function(e){if(e.result){t.customOption={disabledDate:function t(a){if((0,u.default)(a).format("YYYY-MM-DD")!==(0,u.default)(new Date).format("YYYY-MM-DD")&&(e.data.includes((0,u.default)(a).format("YYYY-MM-DD"))||a>new Date)){return true}}}}else{t.showBkMessage(e.message)}})},changeTemplate:function e(){if(this.curTemplateId===null||this.curTemplateId===""){this.curTemplate=[];this.dailyData=[]}},checkYesterdayDaliy:function e(){var t=this;D().then(function(e){if(!e.result){t.showBkMessage("昨天的日报还没写！记得补上哦！","warning",8e3)}})},init:function e(){var t=this;this.cheakDailyDates();this.getDailyReport();g().then(function(e){if(e.result){if(e.data.length!==0&&e.data.length!==null){t.groupList=e.data;if(t.groupList.length!==0&&t.groupList.length!==undefined){t.selectedGroup=t.groupList[0].id}}else{t.groupList=[];t.$router.push({name:"MyGroup"})}}else{t.showBkMessage(e.message)}});this.checkYesterdayDaliy()},setAllPrivate:function e(t){var a=m(this.renderList.dailyDataContent),n;try{for(a.s();!(n=a.n()).done;){var i=n.value;var s=m(i.content),r;try{for(s.s();!(r=s.n()).done;){var o=r.value;o.isPrivate=!t}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}},getDailyReport:function e(){var t=this;T(this.formatDate).then(function(e){if(Object.keys(e.data).length){t.hasWrittenToday=true;t.renderList={dailyDataTitle:[],dailyDataContent:[],newTemplateContent:[]};var a=m(e.data.content),n;try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.type==="table"){t.renderList.dailyDataTitle.push(i.title);t.renderList.dailyDataContent.push(i)}else{t.renderList.newTemplateContent.push(i)}}}catch(e){a.e(e)}finally{a.f()}}else{t.notFilledRender()}})},notFilledRender:function e(){this.hasWrittenToday=false;this.renderList={dailyDataTitle:["今日任务","明日计划"],dailyDataContent:[{title:"今日任务",type:"table",content:[{cost:0,isPrivate:true}]},{title:"明日计划",type:"table",content:[{cost:0,isPrivate:true}]}],newTemplateContent:[{title:"感想",type:"text",text:""}]}},dealAdd:function e(t){var a=this.renderList.dailyDataContent[t].content.length;if(a&&!this.renderList.dailyDataContent[t].content[a-1].text){this.showBkMessage("前一条内容为空")}else{var n={text:"",cost:0,isPrivate:this.allPrivate,$index:a};this.renderList.dailyDataContent[t].content.push(n)}},deleteContent:function e(t,a){this.renderList.dailyDataContent[a]["content"].splice(t.$index,1);var n=m(this.renderList.dailyDataContent[a]["content"]),i;try{for(n.s();!(i=n.n()).done;){var s=i.value;if(t.$index<s.$index){s.$index--}}}catch(e){n.e(e)}finally{n.f()}},saveDaily:function e(){var t=this;var a=false;var n=[];this.newPostDaily.date=(0,u.default)(this.formatDate).format(u.default.HTML5_FMT.DATE);for(var i in this.renderList.dailyDataContent){this.renderList.dailyDataContent[i].title=this.renderList.dailyDataTitle[i]}var s=m(this.renderList.dailyDataContent),r;try{for(s.s();!(r=s.n()).done;){var o=r.value;var l=o.content.length;if(l){if(!o.content[l-1].text){a=true;n.push(o.title+"最后一条")}else{var c=m(o.content),d;try{for(c.s();!(d=c.n()).done;){var f=d.value;if(f.cost===null||f.cost===""||f.cost===undefined){f.cost=0}f.cost=parseFloat(f.cost)}}catch(e){c.e(e)}finally{c.f()}this.newPostDaily.content.push(o)}}else{a=true;n.push(o.title)}}}catch(e){s.e(e)}finally{s.f()}var v=m(this.renderList.newTemplateContent),h;try{for(v.s();!(h=v.n()).done;){var p=h.value;if(!p.text.length){a=true;n.push(p.title)}this.newPostDaily.content.push(p)}}catch(e){v.e(e)}finally{v.f()}if(!a){L(this.newPostDaily).then(function(e){t.hasWrittenToday=true;t.newPostDaily={date:null,content:[],template_id:0,send_email:false};t.showBkMessage(e.message,"success")})}else{this.showBkMessage(n.join(",")+" 内容为空！");this.newPostDaily.content=[]}},moreTemplateDialogChange:function e(t){if(t===false){this.newTitle=""}},getLeaveList:function e(t){var a=this;var n=this.selectedGroup;if(t===null||t===undefined){t=0}if(n===-1){this.showBkMessage("用户当前未加入任何组，无请假信息。")}else{this.isleaveTableLoad=true;this.leaveTableData.data=[];var i=(0,u.default)(new Date).format(u.default.HTML5_FMT.DATE);w(n,i,t).then(function(e){if(e.result){if(e.data.length!==null&&e.data.length!==0){if(t===2){a.setLeavThDate(e.data)}else if(t===0){a.leaveRender(e.data)}}}else{a.showBkMessage(e.message)}}).finally(function(){a.isleaveTableLoad=false})}},setLeavThDate:function e(t){var a=this;this.curUserLeaveList=t;this.customLeaveOption={disabledDate:function e(t){var n=new Date;if(t<n.setHours(n.getHours()-24)){return true}else{var i=true;a.curUserLeaveList.map(function(e,a){var n=(0,u.default)(t).format("YYYY-MM-DD");var s=(0,u.default)(e[0]).format("YYYY-MM-DD");var r=(0,u.default)(e[1]).format("YYYY-MM-DD");if((0,u.default)(s).isSameOrBefore(n,"day")&&(0,u.default)(n).isSameOrBefore(r,"day")){i=false}});return!i}}}},leaveRender:function e(t){var a=this;this.timeSort(t).map(function(e,t){a.leaveTableData.data.push({offdayId:e.off_info.id,start_date:e.off_info.start_date,end_date:e.off_info.end_date,reason:e.off_info.reason,info:e.username+e.name,username:e.username,name:e.name})})},hiddenSlider:function e(){this.leaveFormData.reason="";this.leaveFormData.dateTimeRange=[new Date,new Date];this.activeTabTitle="请假申请"},changeTab:function e(t){this.activeTabTitle=t;if(this.activeTabTitle==="请假信息"){this.getLeaveList();this.getLeaveList(2)}},handleSelectGroup:function e(){this.getLeaveList();this.getLeaveList(2)},clearDate:function e(){this.leaveFormData.dateTimeRange=-1},submitLeave:function e(){var t=this;if(this.leaveFormData.reason===""){this.showBkMessage("请填写请假原因");return}var a={};a.start_date=(0,u.default)(this.leaveFormData.dateTimeRange[0]).format(u.default.HTML5_FMT.DATE);a.end_date=(0,u.default)(this.leaveFormData.dateTimeRange[1]).format(u.default.HTML5_FMT.DATE);a.reason=this.leaveFormData.reason;_(a).then(function(e){if(e.result){t.showBkMessage(e.message,"success");t.getLeaveList(2)}else{t.showBkMessage(e.message)}})},clickLeaveManage:function e(){this.leaveSetting.visible=true;this.getLeaveList(2)},checkSpendTime:function e(t,a){if(!t){this.renderList.dailyDataContent[0].content[a].cost=0}},removeLeave:function e(t){var a=this;var n=this.selectedGroup;var i=t.offdayId;if(n===-1){this.showBkMessage("用户当前未加入任何组，无请假信息可删除。")}else{this.$bkInfo({title:"确认删除该请假信息？",confirmLoading:true,confirmFn:function e(){k(n,i).then(function(e){if(e.result){a.showBkMessage(e.message,"success");a.getLeaveList();a.getLeaveList(2)}else{a.showBkMessage(e.message)}})}})}},timeSort:function e(t){return t.sort(function(e,t){if(t.off_info.start_date>e.off_info.start_date){return-1}if(t.off_info.start_date<e.off_info.start_date){return 1}})},showBkMessage:function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"warning";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2e3;var i={offsetY:80,delay:n,theme:a,message:t};this.$bkMessage(i)},textChange:function e(t,a,n){this.deleteContent(t,a)},changeNumber:function e(t,a,n,i){if(i<0){t.cost=0}if(i>24){t.cost=24;i=24}}}};t.default=x},99:function(e,t,a){"use strict";a.r(t);var n=a(100);var i=a.n(n);for(var s in n)if(s!=="default")(function(e){a.d(t,e,function(){return n[e]})})(s);t["default"]=i.a}}]);