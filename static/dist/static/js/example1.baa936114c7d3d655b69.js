(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{230:function(t,e,a){"use strict";var i=a(88);var n=a.n(i);var s=n.a},235:function(t,e,a){"use strict";var i=function(){var t=this;var e=t.$createElement;var a=t._self._c||e;return a("div",{staticClass:"body"},[a("div",{staticClass:"container"},[a("div",{staticClass:"top_container"},[a("span",{staticStyle:{display:"inline-block","margin-left":"50px"}},[t._v("选择日期：")]),t._v(" "),a("bk-date-picker",{staticClass:"mr15",attrs:{clearable:false,placeholder:"选择日期","ext-popover-cls":"custom-popover-cls",options:t.customOption},on:{change:function(e){t.changeDate(t.reportDate)}},model:{value:t.reportDate,callback:function(e){t.reportDate=e},expression:"reportDate"}}),t._v(" "),a("div",[a("h2",{staticClass:"mr30 f20",staticStyle:{margin:"0"}},[t._v("\n                    日报状态：\n                    "),t.hasWrittenToday?a("span",{staticStyle:{color:"#3A84FF","font-size":"18px"}},[t._v("已写日报")]):a("span",{staticStyle:{color:"#63656E","font-size":"18px"}},[t._v("未写日报")])])]),t._v(" "),a("div",[a("span",{staticClass:"mr10 f20"},[t._v("隐私模式")]),t._v(" "),a("bk-switcher",{staticClass:"mr30",attrs:{size:"large"},model:{value:t.dailyData.isPrivate,callback:function(e){t.$set(t.dailyData,"isPrivate",e)},expression:"dailyData.isPrivate"}})],1),t._v(" "),a("bk-button",{staticClass:"mr30",staticStyle:{display:"inline-block"},attrs:{theme:"primary"},on:{click:t.saveDaily}},[t._v("\n                保存\n            ")]),t._v(" "),a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:"success"},on:{click:function(e){t.moreTemplateDialog.visible=true}}},[t._v("\n                添加模板\n            ")])],1),t._v(" "),a("div",{staticClass:"bottom_container"},[t._l(t.dailyData.title,function(e,i){return[a("div",{key:i},[a("div",{staticStyle:{display:"flex","justify-content":"space-between",margin:"10px 0"}},[a("h2",{ref:"title"+i,refInFor:true,staticStyle:{display:"inline-block",margin:"0"},attrs:{contenteditable:"true"},on:{input:function(e){t.changeTitleText(i)}}},[t._v(t._s(e))]),t._v(" "),a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:"primary"},on:{click:function(e){t.dealAdd(i)}}},[t._v("\n                            新增一条内容\n                        ")])],1),t._v(" "),a("div",[a("bk-table",{staticStyle:{"margin-top":"15px"},attrs:{data:t.dailyData.content[i],"virtual-render":true,height:"175px"}},[a("bk-table-column",{attrs:{prop:"content",label:"内容"}}),t._v(" "),a("bk-table-column",{attrs:{width:"150",prop:"cost",label:"所花时间"}}),t._v(" "),a("bk-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("bk-button",{attrs:{theme:"warning",text:""},on:{click:function(a){t.changeContent(e.row,i)}}},[t._v("\n                                        修改\n                                    ")]),t._v(" "),a("bk-button",{attrs:{theme:"danger",text:""},on:{click:function(a){t.deleteContent(e.row,i)}}},[t._v("\n                                        删除\n                                    ")])]}}])})],1)],1)])]}),t._v(" "),a("bk-dialog",{attrs:{title:"新增内容","header-position":t.addDialog.headerPosition,width:t.addDialog.width,position:{top:20,left:100}},on:{"value-change":t.addDialogChange},model:{value:t.addDialog.visible,callback:function(e){t.$set(t.addDialog,"visible",e)},expression:"addDialog.visible"}},[a("div",[a("h3",[t._v("内容")]),t._v(" "),a("bk-input",{attrs:{placeholder:"新内容",type:"textarea",rows:3},model:{value:t.newContent,callback:function(e){t.newContent=e},expression:"newContent"}}),t._v(" "),a("h3",[t._v("所花时间")]),t._v(" "),a("bk-input",{attrs:{placeholder:"所花时间",type:"number",precision:1,min:0},model:{value:t.newCost,callback:function(e){t.newCost=e},expression:"newCost"}},[a("template",{slot:"append"},[a("div",{staticClass:"group-text"},[t._v("小时")])])],2)],1),t._v(" "),a("div",{staticClass:"dialog-foot",attrs:{slot:"footer"},slot:"footer"},[a("div",[t.isAdd?a("bk-button",{attrs:{theme:"primary",title:"分享"},on:{click:t.addRow}},[t._v("\n                            添加\n                        ")]):a("bk-button",{attrs:{theme:"primary",title:"分享"},on:{click:t.changeRow}},[t._v("\n                            修改\n                        ")])],1)])]),t._v(" "),a("bk-dialog",{attrs:{"header-position":t.moreTemplateDialog.headerPosition,width:t.moreTemplateDialog.width,position:{top:20,left:100}},on:{"value-change":t.moreTemplateDialogChange},model:{value:t.moreTemplateDialog.visible,callback:function(e){t.$set(t.moreTemplateDialog,"visible",e)},expression:"moreTemplateDialog.visible"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"mr30"},[t._v("新增模板标题")])]),t._v(" "),a("div",[a("bk-input",{attrs:{placeholder:"新增模板标题",type:"text"},model:{value:t.newTitle,callback:function(e){t.newTitle=e},expression:"newTitle"}})],1),t._v(" "),a("div",{staticClass:"dialog-foot",attrs:{slot:"footer"},slot:"footer"},[a("div",[a("bk-button",{attrs:{theme:"primary",title:"分享"},on:{click:t.addTemplate}},[t._v("\n                            添加\n                        ")])],1)])])],2),t._v(" "),t._l(t.dailyTemplates,function(e,i){return[a("div",{key:i},[a("div",{staticStyle:{display:"flex","justify-content":"space-between",margin:"10px 0"}},[a("h2",{staticStyle:{display:"inline-block",margin:"0"}},[t._v(t._s(e))]),t._v(" "),i>0?a("bk-button",{staticStyle:{display:"inline-block"},attrs:{theme:"primary"},on:{click:function(e){t.deleteTemplate(i)}}},[t._v("\n                        删除该模板\n                    ")]):t._e()],1),t._v(" "),a("bk-input",{attrs:{placeholder:"请输入",type:"textarea",rows:3},model:{value:t.templateContent[i],callback:function(e){t.$set(t.templateContent,i,e)},expression:"templateContent[index]"}})],1)]})],2)])};var n=[];a.d(e,"a",function(){return i});a.d(e,"b",function(){return n})},74:function(t,e,a){"use strict";a.r(e);var i=a(235);var n=a(86);for(var s in n)if(s!=="default")(function(t){a.d(e,t,function(){return n[t]})})(s);var l=a(230);var o=a(2);var r=Object(o["a"])(n["default"],i["a"],i["b"],false,null,"d166dac0",null);e["default"]=r.exports},86:function(t,e,a){"use strict";a.r(e);var i=a(87);var n=a.n(i);for(var s in i)if(s!=="default")(function(t){a.d(e,t,function(){return i[t]})})(s);e["default"]=n.a},87:function(t,e,a){"use strict";var i=a(0);Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;var n=i(a(85));var s={data:function t(){return{curDate:new Date,formatDate:"",addDialog:{visible:false,width:600,headerPosition:"left"},isAdd:true,targetRow:0,moreTemplateDialog:{visible:false,width:600,headerPosition:"left"},dailyData:{title:["今日任务","明日计划"],content:[[],[]],isPrivate:false},dailyDates:[],newContent:"",newCost:0,currentIndex:0,postDaily:{date:null,content:{},template_id:0,send_email:false,isPrivate:0},dailyTemplates:["感想"],templateContent:[],newTitle:"",hasWrittenToday:false,customOption:{disabledDate:function t(e){if(e>new Date){return true}}}}},created:function t(){this.formatDate=(0,n.default)(new Date).format(n.default.HTML5_FMT.DATE);var e=this.$route.query.date;if(e!==undefined){this.reportDate=new Date(e);this.formatDate=e}else{this.reportDate=new Date}this.init()},methods:{changeDate:function t(e){this.formatDate=(0,n.default)(e).format(n.default.HTML5_FMT.DATE);this.getDailyReport()},cheakDailyDates:function t(){var e=this;this.$http.get("/get_reports_dates/").then(function(t){if(t.result){e.dailyDates=t.data;e.customOption={disabledDate:function t(a){if(e.dailyDates.includes((0,n.default)(a).format("YYYY-MM-DD"))||e.curDate<a){return true}}}}else{e.$bkMessage({offsetY:80,message:t.message,theme:"error"})}})},changeTemplate:function t(){if(this.curTemplateId===null||this.curTemplateId===""){this.curTemplate=[];this.dailyData=[]}},selectTemplate:function t(){this.dailyData=[];var e=this;e.templateList.forEach(function(t){if(t.id===e.curTemplateId){e.curTemplate=t.content.split(";")}})},init:function t(){this.cheakDailyDates();this.getDailyReport()},getDailyReport:function t(){var e=this;this.$http.get("/daily_report/?date="+this.formatDate).then(function(t){e.cheakDailyDates();if(Object.keys(t.data).length){e.hasWrittenToday=true}else{e.hasWrittenToday=false}})},changeTitleText:function t(e){var a="title"+e;this.dailyData.title[e]=this.$refs[a][0].innerText},dealAdd:function t(e){this.currentIndex=e;this.isAdd=true;this.addDialog.visible=true},addRow:function t(){var e={content:this.newContent,cost:this.newCost+"小时"};this.dailyData.content[this.currentIndex].push(e);this.addDialog.visible=false},changeRow:function t(){var e={content:this.newContent,cost:this.newCost+"小时"};this.dailyData.content[this.currentIndex].splice(this.targetRow,1,e);this.addDialog.visible=false},changeContent:function t(e,a){this.currentIndex=a;this.newContent=e.content;this.newCost=parseFloat(e.cost);this.targetRow=e.$index;this.isAdd=false;this.addDialog.visible=true},deleteContent:function t(e,a){this.dailyData.content[a].splice(e.$index,1);this.$bkMessage({theme:"success",message:"移除成功"})},saveDaily:function t(){var e=this;this.postDaily.date=this.formatDate;for(var a in this.dailyData.content){this.postDaily.content[this.dailyData.title[a]]=this.dailyData.content[a]}for(var i in this.templateContent){this.postDaily.content[this.dailyTemplates[i]]=this.templateContent[i]}this.postDaily.content["isPrivate"]=this.dailyData.isPrivate;this.$http.post("/daily_report/",this.postDaily).then(function(t){e.hasWrittenToday=true;e.$bkMessage({theme:"success",message:t.message})})},addTemplate:function t(){this.dailyTemplates.push(this.newTitle);this.moreTemplateDialog.visible=false},deleteTemplate:function t(e){this.dailyTemplates.splice(e,1)},addDialogChange:function t(e){if(e===false){this.newContent="";this.newCost=0}},moreTemplateDialogChange:function t(e){if(e===false){this.newTitle=""}}}};e.default=s},88:function(t,e,a){}}]);