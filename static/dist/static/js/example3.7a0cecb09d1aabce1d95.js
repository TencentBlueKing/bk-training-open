(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{115:function(e,t,i){"use strict";i.r(t);var n=i(116);var s=i.n(n);for(var a in n)if(a!=="default")(function(e){i.d(t,e,function(){return n[e]})})(a);t["default"]=s.a},116:function(e,t,i){"use strict";var n=i(0);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;i(30);i(102);var s=n(i(21));var a=n(i(32));var r=n(i(22));var o=n(i(96));var u=n(i(124));var l=n(i(125));var c=n(i(91));var d=n(i(103));var p=n(i(104));var m=i(264);var f=n(i(31));var h=f.default.getallGroups,v=f.default.getGroupInfo,g=f.default.getAllUsers,b=f.default.getUser,G=f.default.addGroup,k=f.default.getNotJoinGroup,w=f.default.deleteGroup,D=f.default.getGroupUsers,I=f.default.addGroupUsers,_=f.default.deleteGroupUsers,A=f.default.updateGroup,y=f.default.ApplyJoinGroup;var x={components:{bkSelect:p.default,bkOption:d.default,bkDialog:c.default,bkTable:l.default,bkTableColumn:u.default,bkButton:o.default},data:function e(){return{isAdmin:"",curGroupId:"",AllgGroupsist:[],curGroupData:[],AllUsers:[],isshowDialog:false,dialogTitle:"",selectAdminIDList:[],selectAdminList:[],newGroup:"",myMsg:{},NotJoinGroup:[],selectJoinGroup:[],selectCompileadminID:[],selectCompileadminList:[],groupUsers:[],tableSelect:[],funcName:"",size:"small",selectnotakeUsersID:[],pagination:{current:1,count:100,limit:10}}},computed:{dialogConfirm:function e(){var t=function e(){};if(this.funcName==="addGroup"){t=this.confirmAdd}else if(this.funcName==="applyJoinGroup"){t=this.confirmApplyJoinGroup}else if(this.funcName==="compileGroup"){t=this.compileGroup}else if(this.funcName==="addGroupUser"){t=this.compileaddGroupUser}return t},dialogCancel:function e(){var t=function e(){};if(this.funcName==="addGroup"){t=this.cancelAdd}else if(this.funcName==="applyJoinGroup"){t=this.cancelApplyJoinGroup}else if(this.funcName==="compileGroup"){t=this.cancelcompileGroup}else if(this.funcName==="addGroupUser"){t=this.canceladdGroupUser}return t},renderGroupUsers:function e(){return this.groupUsers.slice((this.pagination.current-1)*this.pagination.limit,this.pagination.current*this.pagination.limit)},adminIDList:function e(){return this.curGroupData.admin_list.map(function(e){return e.id})},notakeUsers:function e(){var t=this.groupUsers.map(function(e){return e.id});return this.AllUsers.filter(function(e){if(!t.includes(e.id)){return e}})},existAdmin:function e(){var t=this;var i=true;if(this.tableSelect.length===0){this.handleBox("error","未选中成员");i=false}this.adminIDList.forEach(function(e){if(t.tableSelect&&t.tableSelect.map(function(e){return e.id}).includes(e)){t.handleBox("error","不能选择删除管理员");i=false}});return i}},created:function e(){var t=this;b().then(function(e){t.myMsg=e.data});g().then(function(e){t.AllUsers=e});this.initGroup();k().then(function(e){t.NotJoinGroup=e})},methods:{initGroup:function e(){var t=this;h().then(function(e){if(e.data.length!==0){t.AllgGroupsist=e.data;t.curGroupId=e.data[0].id;t.curGroupname=e.data[0].name;t.getGroupInfoData(e.data[0].id);t.selectCompileadminID=t.adminIDList}else{t.curGroupData=[];t.curGroupId="";t.groupUsers=[];t.AllgGroupsist=[]}})},changeGroup:function e(t){this.curGroupId=t;this.getGroupInfoData(t)},getGroupInfoData:function e(t){var i=this;v(t).then(function(e){i.curGroupData=e.data;i.isAdmin=(0,m.isAdmin)(i.myMsg.username,e.data.admin);i.updateRender(t)})},executeFunc:function e(t,i){if(t==="compileGroup"){this.selectCompileadminID=this.adminIDList;this.getadminMsg()}this.isshowDialog=true;this.funcName=t;this.dialogTitle=i},confirmAdd:function e(){var t=this;if(this.newGroup===""){this.handleBox("error","请补全内容");return}this.myMsg.display_name=this.myMsg.name;this.selectAdminList.unshift(this.myMsg);this.AllUsers.forEach(function(e){if(t.selectAdminIDList.includes(e.id)&&e.id!==t.myMsg.id){t.selectAdminList.push(e)}});G({name:this.newGroup,admin:this.selectAdminList}).then(function(e){t.handleBox("success","添加成功");t.isshowDialog=false;h().then(function(i){t.AllgGroupsist=i.data;t.changeGroup(e.data.group_id)})});this.clearAddInput()},cancelAdd:function e(){this.clearAddInput()},clearAddInput:function e(){this.newGroup="";this.selectAdminIDList=[];this.selectAdminList=[]},handleBox:function e(t,i){var n=t==="success"?{offsetY:80,message:i,theme:"success"}:{offsetY:80,message:i,theme:"error"};this.$bkMessage(n)},confirmApplyJoinGroup:function e(){var t=this;return(0,r.default)(s.default.mark(function e(){var i;return s.default.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=(0,a.default)(t.selectJoinGroup);Promise.all((0,a.default)(i.map(function(e){return y({group_id:e})}))).then(function(e){k().then(function(e){t.selectJoinGroup=[];t.NotJoinGroup=e;t.isshowDialog=false;t.handleBox("success","申请成功")})});case 2:case"end":return n.stop()}}},e)}))()},cancelApplyJoinGroup:function e(){this.selectJoinGroup=[]},compileGroup:function e(){var t=this;this.getadminMsg();if(!this.selectCompileadminID.includes(this.myMsg.id)){this.selectCompileadminList.push(this.myMsg)}A(this.curGroupId,{name:this.curGroupData.name,admin:this.selectCompileadminList}).then(function(e){t.handleBox("success","编辑成功");t.isshowDialog=false;t.selectCompileadminList=[];t.selectCompileadminID=[];h().then(function(e){t.AllgGroupsist=e.data;t.changeGroup(t.curGroupId)})})},getadminMsg:function e(){var t=this;this.selectCompileadminList=[];this.AllUsers.forEach(function(e){if(t.selectCompileadminID.includes(e.id)){t.selectCompileadminList.push(e)}})},delete_Group:function e(){this.showBkInfo("确认要删除？",this.deleteCurGroup)},deleteCurGroup:function e(){var t=this;w(this.curGroupId).then(function(e){if(e.result){t.initGroup();t.handleBox("success","删除成功")}else{t.handleBox("error","删除失败")}})},LimitChange:function e(t){this.pagination.limit=t;this.pagination.current=1},handlePageChange:function e(t){this.pagination.current=t},compileaddGroupUser:function e(){var t=this;if(this.selectnotakeUsersID.length!==0){I(this.curGroupId,this.selectnotakeUsersID).then(function(e){if(e.result){t.isshowDialog=false;t.selectnotakeUsersID=[];t.handleBox("success","成员添加成功");t.changeGroup(t.curGroupId)}})}else{this.handleBox("error","请先选择成员")}},canceladdGroupUser:function e(){this.isshowDialog=false;this.selectnotakeUsersID=[]},removeGroupUser:function e(t){this.showBkInfo("确认删除该用户？",this.confirmDelete(t))},confirmDelete:function e(t){var i=this;return function(){var e={user_id:t.id};_(i.curGroupId,e).then(function(e){i.handleBox("success","移除成功");i.changeGroup(i.curGroupId)})}},selecchange:function e(t){this.tableSelect=t},alldeleteUsers:function e(){if(this.existAdmin)this.showBkInfo("确认要批量删除数据？",this.confirmAllDelete)},updateRender:function e(t){var i=this;D(t).then(function(e){i.pagination.count=e.data.length;i.groupUsers=e.data.sort(function(e,t){if(i.adminIDList.includes(e.id)&&i.adminIDList.includes(t.id)||i.adminIDList.includes(e.id)&&!i.adminIDList.includes(t.id)||i.adminIDList.includes(e.id)&&!i.adminIDList.includes(t.id)){return-1}return 1})})},showBkInfo:function e(t,i){this.$bkInfo({title:t,confirmFn:i})},confirmAllDelete:function e(){var t=this;Promise.all(this.tableSelect.map(function(e){return e.id}).map(function(e){_(t.curGroupId,{user_id:e})})).then(function(e){t.handleBox("success","成功移除".concat(e.length,"个成员"));t.changeGroup(t.curGroupId)})}}};t.default=x},117:function(e,t,i){},264:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.isAdmin=void 0;var n=function e(t,i){return i.includes(t)};t.isAdmin=n},265:function(e,t,i){"use strict";var n=i(117);var s=i.n(n);var a=s.a},270:function(e,t,i){"use strict";var n=function(){var e=this;var t=e.$createElement;var i=e._self._c||t;return i("div",{staticClass:"mygroup"},[i("div",{staticClass:"group-msg"},[i("div",{staticClass:"group-msg-groupname"},[i("bk-select",{staticStyle:{width:"250px"},attrs:{behavior:"simplicity",searchable:"","ext-cls":"group-msg-curgroupid",clearable:false},on:{selected:e.changeGroup},model:{value:e.curGroupId,callback:function(t){e.curGroupId=t},expression:"curGroupId"}},e._l(e.AllgGroupsist,function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})}),1)],1),e._v(" "),i("div",{staticClass:"group-msg-admin"},[i("div",{staticClass:"group-msg-admin-title"},[e._v("管理员: ")]),e._v(" "),i("div",{staticClass:"group-msg-admin-list"},e._l(e.curGroupData.admin_list,function(t,n){return i("div",{key:n,staticClass:"group-msg-admin-item"},[e._v("\n                    "+e._s(t.username)+"("+e._s(t.name)+")\n                    "),n!==e.adminIDList.length-1?i("span",{staticStyle:{backgroundColor:"white"}},[e._v(" / ")]):e._e()])}),0)]),e._v(" "),i("div",{staticClass:"group-func"},[i("div",{staticClass:"group-func-major"},[i("bk-button",{staticClass:"group-func-major-item",attrs:{title:"primary",text:true,"hover-theme":"primary"},on:{click:function(t){e.executeFunc("addGroup","新增组")}}},[e._v("\n                    新增小组\n                ")]),e._v(" "),i("bk-button",{staticClass:"group-func-major-item",attrs:{title:"primary",text:true,"hover-theme":"primary"},on:{click:function(t){e.executeFunc("applyJoinGroup","请求入组")}}},[e._v("\n                    请求入组\n                ")]),e._v(" "),i("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.isAdmin,expression:"isAdmin"}],staticClass:"group-func-major-item",attrs:{text:true,"hover-theme":"primary"},on:{click:function(t){e.executeFunc("compileGroup","编辑组")}}},[e._v("\n                    编辑小组\n                ")]),e._v(" "),i("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.isAdmin,expression:"isAdmin"}],staticClass:"group-func-major-item",attrs:{text:true,"hover-theme":"danger"},on:{click:function(t){e.delete_Group()}}},[e._v("\n                    删除小组\n                ")])],1)])]),e._v(" "),i("div",{staticClass:"group-member"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isAdmin,expression:"isAdmin"}],staticClass:"group-member-func"},[i("bk-button",{attrs:{"ext-cls":"group-member-func-add"},on:{click:function(t){e.executeFunc("addGroupUser","新增成员")}}},[e._v("\n                新增成员\n            ")]),e._v(" "),i("bk-button",{attrs:{"ext-cls":"group-member-func-batchdel"},on:{click:e.alldeleteUsers}},[e._v("\n                批量删除\n            ")])],1),e._v(" "),i("div",{staticClass:"group-member-renderlist"},[i("bk-table",{attrs:{data:e.renderGroupUsers,size:e.size,pagination:e.pagination},on:{"selection-change":e.selecchange,"page-change":e.handlePageChange,"page-limit-change":e.LimitChange}},[i("bk-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),i("bk-table-column",{attrs:{type:"index",label:"序列",width:"60"}}),e._v(" "),i("bk-table-column",{attrs:{label:"用户名",prop:"username"}}),e._v(" "),i("bk-table-column",{attrs:{label:"姓名",prop:"name"}}),e._v(" "),i("bk-table-column",{attrs:{label:"电话",prop:"phone"}}),e._v(" "),i("bk-table-column",{attrs:{label:"邮箱",prop:"email"}}),e._v(" "),i("bk-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:!e.isAdmin||e.curGroupData.admin.includes(t.row.username)},on:{click:function(i){e.removeGroupUser(t.row)}}},[e._v("移除")])]}}])})],1)],1)]),e._v(" "),i("bk-dialog",{staticClass:"group-dialog",attrs:{theme:"primary","mask-close":false,"header-position":e.left,"auto-close":false,title:e.dialogTitle},on:{confirm:function(t){e.dialogConfirm()},cancel:function(t){e.dialogCancel()}},model:{value:e.isshowDialog,callback:function(t){e.isshowDialog=t},expression:"isshowDialog"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.funcName==="addGroup",expression:"funcName === 'addGroup'"}]},[i("bk-form",{attrs:{"label-width":"120"}},[i("bk-form-item",{attrs:{label:"组名称",required:"true"}},[i("bk-input",{model:{value:e.newGroup,callback:function(t){e.newGroup=t},expression:"newGroup"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"管理员"}},[i("bk-select",{attrs:{searchable:"",multiple:"","display-tag":""},model:{value:e.selectAdminIDList,callback:function(t){e.selectAdminIDList=t},expression:"selectAdminIDList"}},e._l(e.AllUsers,function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.username+"("+e.display_name+")"}})}),1)],1)],1)],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.funcName==="applyJoinGroup",expression:"funcName === 'applyJoinGroup'"}]},[i("bk-form",{attrs:{"label-width":"120"}},[i("bk-form-item",{attrs:{label:"组名称",required:"true"}},[i("bk-select",{attrs:{searchable:"",multiple:"","display-tag":""},model:{value:e.selectJoinGroup,callback:function(t){e.selectJoinGroup=t},expression:"selectJoinGroup"}},e._l(e.NotJoinGroup,function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.group_name}})}),1)],1)],1)],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.funcName==="compileGroup",expression:"funcName === 'compileGroup'"}]},[i("bk-form",{attrs:{"label-width":"120"}},[i("bk-form-item",{attrs:{label:"组名称",required:"true"}},[i("bk-input",{model:{value:e.curGroupData.name,callback:function(t){e.$set(e.curGroupData,"name",t)},expression:"curGroupData.name"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"管理员"}},[i("bk-select",{attrs:{searchable:"",multiple:"","display-tag":""},model:{value:e.selectCompileadminID,callback:function(t){e.selectCompileadminID=t},expression:"selectCompileadminID"}},e._l(e.AllUsers,function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.username+"("+e.display_name+")"}})}),1)],1)],1)],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.funcName==="addGroupUser",expression:"funcName === 'addGroupUser'"}]},[i("bk-form",{attrs:{"label-width":"120"}},[i("bk-form-item",{attrs:{label:"新成员",required:"true"}},[i("bk-select",{attrs:{searchable:"",multiple:"","display-tag":""},model:{value:e.selectnotakeUsersID,callback:function(t){e.selectnotakeUsersID=t},expression:"selectnotakeUsersID"}},e._l(e.notakeUsers,function(e){return i("bk-option",{key:e.id,attrs:{id:e.id,name:e.username+"("+e.display_name+")"}})}),1)],1)],1)],1)])],1)};var s=[];i.d(t,"a",function(){return n});i.d(t,"b",function(){return s})},90:function(e,t,i){"use strict";i.r(t);var n=i(270);var s=i(115);for(var a in s)if(a!=="default")(function(e){i.d(t,e,function(){return s[e]})})(a);var r=i(265);var o=i(4);var u=Object(o["a"])(s["default"],n["a"],n["b"],false,null,"7bcc2446",null);t["default"]=u.exports}}]);