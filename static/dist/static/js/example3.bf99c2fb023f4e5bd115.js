(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{100:function(e,t,a){"use strict";var r=a(0);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;a(29);a(88);var s=r(a(236));var i=r(a(237));var o={name:"",components:{bkSelect:i.default,bkOption:s.default},data:function e(){return{curUser:{isAdmin:false,info:{id:"",username:""}},groupsData:[],curGroupId:null,curGroup:{id:"",name:"",admin:"",admin_list:[],create_by:"",create_name:"",create_time:""},bkUsers:[],bkUsersExceptGroupUsers:[],bkSelectLoading:true,newUserIds:[],addGroupDialog:{visible:false},addGroupData:{adminIds:[],formData:{name:"",admin:[]}},editGroupDialog:{visible:false},editGroupData:{adminIds:[],formData:{name:"",admin:[]}},deleteGroupDialog:{visible:false},availableApplyGroups:[],availableGroupsIsLoding:true,applyForGroup:{dialogVisible:false,groupId:""},groupUsers:[],addUserDialog:{visible:false},addUserForm:{id:"",username:"",name:"",phone:"",email:""},iscurGroupLoad:true,addUserVisible:false}},activated:function e(){if(!this.curGroupId&&this.iscurGroupLoad){this.init()}else if(this.iscurGroupLoad){this.getGroupInfo(this.curGroupId)}if(this.bkUsers.length===0){this.getAllBKUser()}},methods:{setCurGroup:function e(t){var a=sessionStorage;a.setItem("curGroup",t)},getCurGroup:function e(){var t=sessionStorage;if(t.getItem("curGroup")!==null){this.curGroupId=t.getItem("curGroup")}else{this.curGroupId=this.groupsData[0].id}},RemoveFromGroup:function e(t){var a=this;this.$bkInfo({title:"确认移除该组员吗？",showFooter:true,confirmFn:function e(){a.removeUser(t)}})},getAllBKUser:function e(){var t=this;this.$http.get("/get_all_bk_users/").then(function(e){t.bkUsers=e.data.results;t.updateBkUserExceptGroupUser()})},updateBkUserExceptGroupUser:function e(){var t=this.groupUsers.map(function(e){return e.id});this.bkUsersExceptGroupUsers=this.bkUsers;this.bkUsersExceptGroupUsers.forEach(function(e){e.disabled=t.indexOf(e.id)>=0});this.bkSelectLoading=this.bkUsersExceptGroupUsers.length===0},changeSelectUser:function e(){},getGroupInfo:function e(t){var a=this;this.iscurGroupLoad=true;this.$http.get("/get_group_info/"+t+"/").then(function(e){a.curGroup=e.data;if(!a.groupsData||a.groupsData.length===0){a.$bkMessage({theme:"warning",message:"您还没有加入任何组"});return}a.curUser.isAdmin=false;if(a.curGroup.admin.indexOf(a.curUser.info.username)!==-1){a.curUser.isAdmin=true}a.getGroupUsers(t)}).finally(function(){a.iscurGroupLoad=false})},getGroupUsers:function e(t){var a=this;this.iscurGroupLoad=true;if(!t){this.iscurGroupLoad=false;return}this.$http.get("/get_group_users/"+t+"/").then(function(e){var t=JSON.parse(JSON.stringify(e.data));t.map(function(e,r){if(a.curGroup.admin.indexOf(e.username)!==-1){t.unshift(t.splice(r,1)[0])}});t.map(function(e,t){e.listId=t+1});a.groupUsers=t;a.updateBkUserExceptGroupUser()}).finally(function(){a.iscurGroupLoad=false})},getAvailableApplyGroups:function e(){var t=this;this.availableGroupsIsLoding=true;this.$http.get("/get_available_apply_groups/").then(function(e){t.availableApplyGroups=e.data}).finally(function(){t.availableGroupsIsLoding=false})},changeGroup:function e(t){if(t===""||t===null){this.curGroupId=null;this.curGroup={id:"",name:"",admin:"",admin_list:[],create_by:"",create_name:"",create_time:""};this.groupUsers=[];this.curUser.isAdmin=false}else{this.getGroupInfo(t);this.setCurGroup(t)}},clickAddUser:function e(){this.addUserVisible=true;if(this.bkUsersExceptGroupUsers.length===0){this.updateBkUserExceptGroupUser()}},cancelAddUser:function e(){this.addUserVisible=false;this.newUserIds=[]},addUser:function e(){var t=this;var a={};a.offsetY=80;if(this.newUserIds.length===0){a.message="请选择要添加的用户";this.$bkMessage(a);return}this.$http.post("/add_user/"+this.curGroup.id+"/",{new_user_ids:this.newUserIds}).then(function(e){a.message=e.message;if(e.result){a.theme="success";t.$bkMessage(a);t.newUserIds=[];t.getGroupUsers(t.curGroup.id)}else{a.theme="error";t.$bkMessage(a)}})},clickEditGroup:function e(){this.editGroupDialog.visible=true;this.editGroupData.formData.name=this.curGroup.name;var t=[];var a=this;this.bkUsers.forEach(function(e){if(a.curGroup.admin.indexOf(e.username)!==-1){t.push(e.id)}});this.editGroupData.adminIds=t},showApplyForGroup:function e(){this.applyForGroup.dialogVisible=true;this.getAvailableApplyGroups()},init:function e(){var t=this;this.$http.get("/get_user/").then(function(e){t.curUser.info=e.data;t.$http.get("/get_user_groups/").then(function(e){t.groupsData=e.data;if(!t.groupsData||t.groupsData.length===0){if(t.iscurGroupLoad){t.iscurGroupLoad=false;t.$bkMessage({theme:"warning",message:"您还没有加入任何组"});return}}if(t.groupsData.length!==0){t.getCurGroup()}})}).finally(function(){t.iscurGroupLoad=false})},addGroup:function e(){var t=this;var a=this;var r=[];this.bkUsers.forEach(function(e){if(a.addGroupData.adminIds.indexOf(e.id)!==-1){r.push(e)}});if(this.addGroupData.adminIds.indexOf(this.curUser.info.id)===-1){var s=false;var i=this;this.bkUsers.forEach(function(e){if(i.curUser.info.username===e.username){r.push(e);s=true}});if(!s){var o={};o.message="未在蓝鲸用户平台找到登录用户信息";o.offsetY=80;o.theme="error";this.$bkMessage(o);return}}this.addGroupData.formData.admin=r;this.$http.post("/add_group/",this.addGroupData.formData).then(function(e){var a={};a.offsetY=80;a.message=e.message;if(e.result){a.theme="success";t.$bkMessage(a);t.$http.get("/get_user_groups/").then(function(a){t.groupsData=a.data;t.curGroupId=e.data.group_id;t.changeGroup(t.curGroupId);t.addGroupDialog.visible=false;t.addGroupData.formData.name="";t.addGroupData.adminIds=[]})}else{a.theme="error";t.$bkMessage(a)}})},editGroup:function e(t){var a=this;var r=this;var s=[];this.bkUsers.forEach(function(e){if(r.editGroupData.adminIds.indexOf(e.id)!==-1){s.push(e)}});this.editGroupData.formData.admin=s;this.$http.post("/update_group/"+t+"/",this.editGroupData.formData).then(function(e){var r={};r.offsetY=80;if(e.result){r.message=e.message;r.theme="success";a.$bkMessage(r);a.$http.get("/get_user_groups/").then(function(e){a.groupsData=e.data;a.changeGroup(t);a.editGroupDialog.visible=false})}else{r.message=e.message;r.theme="error";a.$bkMessage(r)}})},deleteGroup:function e(){var t=this;this.$http.post("/delete_group/"+this.curGroupId+"/").then(function(e){var a={};a.offsetY=80;if(e.result){a.message=e.message;a.theme="success";t.$bkMessage(a);t.deleteGroupDialog.visible=false;t.curGroupId=null;t.curGroup={id:"",name:"",admin:"",admin_list:[],create_by:"",create_name:"",create_time:""};t.groupUsers=[];sessionStorage.removeItem("curGroup");t.curUser.isAdmin=false;t.init()}else{a.message=e.message;a.theme="error";t.$bkMessage(a)}})},doApplyforGroup:function e(){var t=this;var a={offsetY:80};this.$http.post("/apply_for_group/",{group_id:this.applyForGroup.groupId}).then(function(e){a.message=e.message;if(e.result){a.theme="success";for(var r in t.availableApplyGroups){if(t.availableApplyGroups[r].id===t.applyForGroup.groupId){t.availableApplyGroups.splice(r,1);break}}t.applyForGroup.dialogVisible=false}else{a.theme="error"}t.$bkMessage(a)})},removeUser:function e(t){var a=this;if(this.curGroup.admin.indexOf(t.username)!==-1){var r={};r.offsetY=80;r.message="不可移除管理员，可通过编辑组信息修改";r.theme="error";this.$bkMessage(r)}else{var s={user_id:t.id};this.$http.post("/exit_group/"+this.curGroup.id+"/",s).then(function(e){var t={};t.offsetY=80;t.message=e.message;if(e.result){a.getGroupUsers(a.curGroup.id);t.theme="success";a.$bkMessage(t)}else{t.theme="error";a.$bkMessage(t)}})}}}};t.default=o},101:function(e,t,a){},242:function(e,t,a){"use strict";var r=a(101);var s=a.n(r);var i=s.a},247:function(e,t,a){"use strict";var r=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",{attrs:{id:"myGroup"}},[a("div",{staticClass:"body"},[a("div",{staticClass:"line-container group-info"},[a("div",{staticClass:"fun-bar"},[a("div",{staticClass:"select-wapper"},[a("span",{staticStyle:{width:"50px"}},[e._v("组名：")]),e._v(" "),a("bk-select",{staticStyle:{"min-width":"140px",display:"inline-block"},attrs:{disabled:false,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom",searchable:""},on:{change:function(t){e.changeGroup(e.curGroupId)}},model:{value:e.curGroupId,callback:function(t){e.curGroupId=t},expression:"curGroupId"}},e._l(e.groupsData,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})}),1)],1),e._v(" "),a("div",{staticClass:"btn-wapper"},[a("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:function(t){e.addGroupDialog.visible=true}}},[e._v("\n                        +新增组\n                    ")]),e._v(" "),a("bk-dialog",{staticClass:"add-group-dialog",attrs:{theme:"primary",title:"新增组","show-footer":false},model:{value:e.addGroupDialog.visible,callback:function(t){e.$set(e.addGroupDialog,"visible",t)},expression:"addGroupDialog.visible"}},[a("bk-form",{attrs:{"label-width":"120"}},[a("bk-form-item",{attrs:{label:"组名称",required:"true"}},[a("bk-input",{model:{value:e.addGroupData.formData.name,callback:function(t){e.$set(e.addGroupData.formData,"name",t)},expression:"addGroupData.formData.name"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"管理员",required:"true"}},[a("bk-select",{staticStyle:{width:"250px","margin-top":"10px"},attrs:{searchable:"",multiple:"","display-tag":""},model:{value:e.addGroupData.adminIds,callback:function(t){e.$set(e.addGroupData,"adminIds",t)},expression:"addGroupData.adminIds"}},e._l(e.bkUsers,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.username+"("+e.display_name+")"}})}),1)],1),e._v(" "),a("bk-form-item",[a("bk-button",{staticStyle:{"margin-left":"20px","margin-right":"40px"},attrs:{theme:"primary",title:"提交"},on:{click:function(t){t.stopPropagation();t.preventDefault();return e.addGroup(t)}}},[e._v("提交")]),e._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(t){e.addGroupDialog.visible=false}}},[e._v("取消")])],1)],1)],1),e._v(" "),a("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.curUser.isAdmin,expression:"curUser.isAdmin"}],ref:"adminClick",staticClass:"mr10",attrs:{disabled:!e.curUser.isAdmin,theme:"primary",title:"编辑组"},on:{click:e.clickEditGroup}},[e._v("\n                        编辑组\n                    ")]),e._v(" "),a("bk-dialog",{staticClass:"add-group-dialog",attrs:{theme:"primary",title:"修改组信息","show-footer":false},model:{value:e.editGroupDialog.visible,callback:function(t){e.$set(e.editGroupDialog,"visible",t)},expression:"editGroupDialog.visible"}},[a("bk-form",{attrs:{"label-width":"120"}},[a("bk-form-item",{attrs:{label:"组名称",required:"true"}},[a("bk-input",{model:{value:e.editGroupData.formData.name,callback:function(t){e.$set(e.editGroupData.formData,"name",t)},expression:"editGroupData.formData.name"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"管理员",required:"true"}},[a("bk-select",{staticStyle:{width:"250px","margin-top":"10px"},attrs:{searchable:"",multiple:"","display-tag":""},model:{value:e.editGroupData.adminIds,callback:function(t){e.$set(e.editGroupData,"adminIds",t)},expression:"editGroupData.adminIds"}},e._l(e.bkUsers,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.username+"("+e.display_name+")"}})}),1)],1),e._v(" "),a("bk-form-item",[a("bk-button",{staticStyle:{"margin-left":"20px","margin-right":"40px"},attrs:{theme:"primary",title:"提交"},on:{click:function(t){t.stopPropagation();t.preventDefault();e.editGroup(e.curGroupId)}}},[e._v("提交")]),e._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(t){e.editGroupDialog.visible=false}}},[e._v("取消")])],1)],1)],1),e._v(" "),a("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.curUser.isAdmin,expression:"curUser.isAdmin"}],staticClass:"mr10",attrs:{disabled:!e.curUser.isAdmin,theme:"primary",title:"删除组"},on:{click:function(t){e.deleteGroupDialog.visible=true}}},[e._v("\n                        删除组\n                    ")]),e._v(" "),a("bk-dialog",{staticClass:"delete-group-dialog",attrs:{theme:"primary","show-footer":false},model:{value:e.deleteGroupDialog.visible,callback:function(t){e.$set(e.deleteGroupDialog,"visible",t)},expression:"deleteGroupDialog.visible"}},[a("bk-form",{attrs:{"label-width":"80"}},[a("bk-form-item",{staticStyle:{"margin-left":"15px"}},[e._v("\n                                确认删除"+e._s(e.curGroup.name)+"吗？\n                            ")]),e._v(" "),a("bk-form-item",[a("bk-button",{staticStyle:{"margin-left":"20px","margin-right":"20px"},attrs:{theme:"primary",title:"提交"},on:{click:function(t){t.stopPropagation();t.preventDefault();return e.deleteGroup(t)}}},[e._v("提交")]),e._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(t){e.deleteGroupDialog.visible=false}}},[e._v("取消")])],1)],1)],1),e._v(" "),a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:"申请入组"},on:{click:function(t){e.showApplyForGroup()}}},[e._v("\n                        申请入组\n                    ")]),e._v(" "),a("bk-dialog",{staticClass:"apply-join-club-dialog",attrs:{theme:"primary","show-footer":false},model:{value:e.applyForGroup.dialogVisible,callback:function(t){e.$set(e.applyForGroup,"dialogVisible",t)},expression:"applyForGroup.dialogVisible"}},[a("bk-form",{attrs:{"label-width":"80"}},[a("bk-form-item",{attrs:{label:"组",required:"true"}},[a("bk-select",{staticStyle:{width:"250px"},attrs:{loading:e.availableGroupsIsLoding,searchable:""},model:{value:e.applyForGroup.groupId,callback:function(t){e.$set(e.applyForGroup,"groupId",t)},expression:"applyForGroup.groupId"}},e._l(e.availableApplyGroups,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.group_name,disabled:!e.is_available}})}),1)],1),e._v(" "),a("bk-form-item",[a("bk-button",{staticStyle:{"margin-left":"20px","margin-right":"40px"},attrs:{theme:"primary",disabled:e.applyForGroup.groupId==="",title:"提交"},on:{click:function(t){t.stopPropagation();t.preventDefault();e.doApplyforGroup()}}},[e._v("提交")]),e._v(" "),a("bk-button",{attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:function(t){e.applyForGroup.dialogVisible=false}}},[e._v("取消")])],1)],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.iscurGroupLoad&&e.curGroupId!==null,expression:"!iscurGroupLoad && curGroupId !== null"}],staticClass:"info-bar"},[a("div",{staticClass:"create-wapper"},[a("div",{staticClass:"create-content"},[e._v("\n                        创建人:\n                        "),e.curGroupId!==null?a("bk-tag",{attrs:{"ext-cls":"create-tag"}},[e._v(e._s(e.curGroup.create_by)+"("+e._s(e.curGroup.create_name)+")")]):e._e(),e._v(" "),e.curGroupId!==null?a("span"):e._e()],1),e._v(" "),a("div",{staticClass:"create-content"},[e._v("\n                        创建时间:\n                        "),a("bk-tag",{attrs:{"ext-cls":"create-tag"}},[e._v(e._s(e.curGroup.create_time))])],1)]),e._v(" "),a("div",{staticClass:"admin-wapper"},[a("span",[e._v("管理员:")]),e._v(" "),e._l(e.curGroup.admin_list,function(t){return a("bk-tag",{key:t.id,attrs:{"ext-cls":"admin-tag"}},[e._v(e._s(t.username)+"("+e._s(t.name)+")")])})],2)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.iscurGroupLoad,expression:"iscurGroupLoad"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.iscurGroupLoad,theme:"primary",zIndex:10},expression:"{ isLoading: iscurGroupLoad, theme: 'primary', zIndex: 10 }"}],staticClass:"info-loading"})]),e._v(" "),a("div",{staticClass:"line-container group-users"},[a("bk-card",{attrs:{title:"组内成员"}},[a("bk-link",{directives:[{name:"show",rawName:"v-show",value:e.curUser.isAdmin&&!e.addUserVisible,expression:"curUser.isAdmin && !addUserVisible"}],attrs:{disabled:!e.curUser.isAdmin,theme:"primary"},on:{click:e.clickAddUser}},[e._v("+新增成员")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.addUserVisible,expression:"addUserVisible"}]},[a("bk-select",{staticClass:"add-user-select",attrs:{searchable:"",multiple:"","display-tag":"","search-with-pinyin":"",loading:e.bkSelectLoading,"is-tag-width-limit":false,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},on:{change:e.changeSelectUser},model:{value:e.newUserIds,callback:function(t){e.newUserIds=t},expression:"newUserIds"}},e._l(e.bkUsersExceptGroupUsers,function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.username+"("+e.display_name+")",disabled:e.disabled}})}),1),e._v(" "),a("bk-button",{staticClass:"add-user-button",attrs:{theme:"primary",title:"添加"},on:{click:function(t){t.stopPropagation();t.preventDefault();return e.addUser(t)}}},[e._v("添加")]),e._v(" "),a("bk-button",{staticClass:"add-user-button",attrs:{"ext-cls":"mr5",theme:"default",title:"取消"},on:{click:e.cancelAddUser}},[e._v("取消")])],1),e._v(" "),a("bk-table",{staticStyle:{"margin-top":"15px"},attrs:{height:"383px",data:e.groupUsers,size:e.size,pagination:e.pagination,"virtual-render":true},on:{"row-mouse-enter":e.handleRowMouseEnter,"row-mouse-leave":e.handleRowMouseLeave,"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[a("bk-table-column",{attrs:{label:"序号",prop:"listId",width:"60"}}),e._v(" "),a("bk-table-column",{attrs:{label:"用户名",prop:"username"}}),e._v(" "),a("bk-table-column",{attrs:{label:"姓名",prop:"name"}}),e._v(" "),a("bk-table-column",{attrs:{label:"电话",prop:"phone"}}),e._v(" "),a("bk-table-column",{attrs:{label:"邮箱",prop:"email"}}),e._v(" "),e.curUser.isAdmin?a("bk-table-column",{attrs:{label:"操作",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("bk-button",{directives:[{name:"show",rawName:"v-show",value:e.curUser.isAdmin,expression:"curUser.isAdmin "}],staticClass:"mr10",attrs:{disabled:e.curGroup.admin.indexOf(t.row.username)!==-1,theme:"primary",text:""},on:{click:function(a){e.RemoveFromGroup(t.row)}}},[e._v("移除")])]}}])}):e._e()],1)],1)],1)])])};var s=[];a.d(t,"a",function(){return r});a.d(t,"b",function(){return s})},87:function(e,t,a){"use strict";a.r(t);var r=a(247);var s=a(99);for(var i in s)if(i!=="default")(function(e){a.d(t,e,function(){return s[e]})})(i);var o=a(242);var u=a(3);var n=Object(u["a"])(s["default"],r["a"],r["b"],false,null,"42337f4d",null);t["default"]=n.exports},99:function(e,t,a){"use strict";a.r(t);var r=a(100);var s=a.n(r);for(var i in r)if(i!=="default")(function(e){a.d(t,e,function(){return r[e]})})(i);t["default"]=s.a}}]);